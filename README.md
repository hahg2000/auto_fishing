# 棕色尘埃2的python钓鱼脚本

## 介绍

基于图像识别进行QTE操作，只点击黄色区域，简单的QTE操作没问题，例如QTE条上有一些遮挡物，把黄色区域覆盖了，就容易失败

## 使用步骤——源码运行

+ 测试环境：
+ Python 3.12.4
+ Pypi 24.0

### 1. 创建虚拟环境

打开空文件夹，并在空文件夹打开`powershell`，输入下面命令

```sh
# py -版本 -m venv 环境名字
py -3.12 -m venv auto_fishing
```
### 2. 进入虚拟环境

继续输入下面命令进入虚拟环境

```sh
# .\环境名字\Scripts\activate
.\auto_fishing\Scripts\activate
```

### 3. 安装必要的依赖

```sh
pip install -r requirements.txt
```

### 4. 运行脚本

运行脚本后，点击一下游戏里，注意游戏界面要全部展示出来，**无其他窗口遮挡，窗口始终处于焦点状态**

```sh
python main.py
```

## 使用步骤——exe运行

### 1. 下载exe

1. 点击 [Actions](https://github.com/hahg2000/auto_fishing/actions)；选择一个最新的工作流；下载 Artifacts 里面的成品

2. 点击 [Release](https://github.com/hahg2000/auto_fishing/releases)；下载最新的版本里的exe制品

### 2. 双击运行，并输入钓鱼的地点

### 3. 然后切到游戏窗口

## 可能遇到的问题

- [x] 识别不到鱼上钩了（识别感叹号来判断鱼是否上钩，深渊巨口地图没有感叹号的匹配度会莫名得高——已判断黄色像素数量
- [x] 背包满了（功能完成了，需要多次测试
- [x] 对于一些干扰QTE的操作容易失败（因为出现的概率少所以不太好测试
- [x] 不同分辨率和颜色范围没有测试过（懂代码的可以自行调整代码里的颜色范围
- [x] 冰霜海峡的锁定光标需要连续点击空格的没有实现
- [ ] 不同分辨率和颜色范围提取到了配置文件，暂时方案：提交测试的工具，可自行修改；最终方案：按照游戏分辨率和颜色范围自动生成配置文件（限于设备因素应该是实现不了了）
- [x] 深渊巨口地图黄色部分有时会消失（增加黄色部分判定时间还是增加判定蓝色部分？
- [x] 深渊巨口地图出现多个光标（增加对比度来判断真的光标？

## 开发计划

地图：没有实现的默认用寒霜海峡钓鱼策略

+ 烟波湖：
+ 浅岸：
+ 寒霜海峡：
  + [x] 光标冰冻——判断qte条是否有红色像素
  + [x] 贝壳挡住光标——只要露出黄色部分都可以判断到
  + [x] 光标隐形——疯狂点击空格（光标隐藏后，黄色部分上下有会有点发光部分，就会疯狂按空格，歪打正着了
+ 深渊巨口：
  + [x] 多个光标出现——把真实光标颜色的范围缩小
  + [ ] 黄色部分消失，只有绿色部分
  + [x] 黄色部分消失，只要蓝色部分——当黄色部分检测不到时，开始检测蓝色部分
  + [ ] 产生有红色数字的泡泡（不知道有什么阻碍
  + [x] 产生隔板来反弹光标行动——不影响所以不处理

- [ ] 引入ocr来判断当前钓鱼地点，来执行不同的钓鱼策略。（如果引入ocr，打包体积会增大。好处是自动识别钓鱼策略和不用触发三次突发时间才清理背包

## 开发指南

如果想自己开发新的地图钓鱼策略：

1. 在 `qte_strategy.py` 里继承 `BaseQTEStrategy` 类，在 `__init__` 初始化需要使用的变量，然后实现 `play_qte` 方法

2. 在 `main.py` 里的 `QTE_STRATEGIES_MAP` 增加刚新增的策略类
